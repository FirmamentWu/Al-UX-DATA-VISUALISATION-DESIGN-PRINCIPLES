# Airbnb 价格分析：模型构建与可视化结果总结

## 📊 生成的可视化图表

### 场景1: 物理空间的溢价逻辑

1. **1_1_privacy_premium.png** - 隐私溢价分析
   - Boxplot 和 Violin plot 展示 Entire home vs Private room 的价格分布
   - **关键发现**: Entire home 中位数 ($175) 是 Private room ($75) 的 **2.33倍**
   - Mann-Whitney U 检验 p < 0.0001，差异显著

2. **1_2_capacity_premium.png** - 容量溢价分析
   - 散点图 + 线性回归线 + LOWESS 平滑
   - **关键发现**: 每增加1人，价格平均增加 **$38.48**
   - Spearman 相关系数 = 0.55 (p < 0.0001)

3. **1_3_interaction_effect.png** - 房型与容量的交互效应
   - 分组散点图展示隐私溢价是否独立于容量
   - **关键发现**: 交互项系数 = -10.75，说明隐私溢价在低容量时更明显

### 场景2: 黄金地段的绝对统治

4. **2_1_spatial_price_heatmap.png** - 空间价格热力图
   - 地理散点图和六边形密度图
   - **关键发现**: 价格明显向曼哈顿核心区集中

5. **2_2_region_comparison.png** - 区域分组对比
   - Boxplot 和 Violin plot 按行政区比较
   - **关键发现**: Manhattan 中位数 ($170) 显著高于其他区域
     - Manhattan: $170
     - Brooklyn: $109
     - Queens/Bronx: $85

6. **2_3_manhattan_subregions.png** - Manhattan 子区域价格跃迁
   - **关键发现**: 黄金地段价格跳跃明显
     - Tribeca: $399
     - Theater District: $378
     - Financial District: $333

7. **2_4_controlled_location_premium.png** - 控制物理条件后的位置溢价
   - 固定 Private room + 1人，比较不同区域
   - **关键发现**: 即使条件相同，核心区（如 Murray Hill $115）仍显著更贵

### 场景3: 运营专业化带来的规模溢价

8. **3_1_scale_premium_price.png** - 房东规模 vs 价格
   - **关键发现**: 规模房东（>5套）价格中位数 ($150) 高于单一房东 ($127)

9. **3_2_scale_occupancy.png** - 房东规模 vs 入住率
   - **关键发现**: 规模越大，空置天数越多（专业化运营的"库存管理"特征）
     - 1套: 0天
     - >5套: 244天

10. **3_3_entire_home_scale.png** - Entire home 场景下的规模溢价
    - 在整租场景下，规模效应依然显著

11. **3_4_entire_home_specialization.png** - 整租专业化 vs 混合运营
    - 多套整租房东的价格和入住率表现

### 场景4: 信任的货币化

12. **4_1_rating_distribution.png** - 评分分布与阈值效应
    - Histogram 和 KDE 图
    - **关键发现**: 评分大量集中在 4.7+，存在明显的高信任阈值

13. **4_2_rating_vs_occupancy.png** - 评分 vs 入住率
    - 散点图 + LOWESS + 线性回归
    - **关键发现**: 评分与空置天数显著负相关（信任转化为入住率）

14. **4_3_superhost_comparison.png** - 超赞房东对比
    - 超赞房东的空置天数显著低于普通房东
    - **关键发现**: 信任标签已被市场定价

### 场景5: 活跃度即需求的实时信号

15. **5_1_reviews_decoupling.png** - 历史评论 vs 近一年评论脱钩
    - **关键发现**: 历史评论与 LTM 评论相关性较弱，存在"过去火但现在冷"的房源

16. **5_2_ltm_vs_price.png** - 近一年评论 vs 价格
    - **关键发现**: LTM 评论数与价格显著正相关（市场为"当下被选择"付费）

17. **5_3_historical_vs_price.png** - 历史评论 vs 价格（对照组）
    - **关键发现**: 历史评论对价格的解释力明显弱于 LTM

18. **5_4_ltm_vs_occupancy.png** - 近一年评论 vs 入住率
    - **关键发现**: LTM 评论数越高，空置天数越少（活跃度 = 真实需求信号）

### 综合模型

19. **comprehensive_price_model.png** - 价格预测模型特征系数
    - 展示各特征对价格的影响方向和强度

## 🔬 使用的统计模型与方法

### 场景1: 物理空间的溢价逻辑

#### 1.1 隐私溢价分析
- **Mann-Whitney U检验** (非参数检验)
  - 用途: 比较 Entire home 和 Private room 两组价格分布是否显著不同
  - 优势: 不假设正态分布，适合价格这种右偏分布
  - 实现: `test_privacy_premium()` 函数

#### 1.2 容量溢价分析
- **线性回归模型** (Linear Regression)
  - 模型: `price ~ accommodates`
  - 用途: 量化每增加1人容量的价格增量
  - 实现: `fit_linear_regression()` 函数 (sklearn)
- **LOWESS平滑** (Locally Weighted Scatterplot Smoothing)
  - 参数: `frac=0.3` (局部窗口大小)
  - 用途: 可视化容量与价格的非线性关系趋势
  - 优势: 非参数方法，不假设函数形式
  - 实现: `fit_lowess()` 函数 (statsmodels)
- **Spearman秩相关系数**
  - 用途: 测量容量与价格的单调关系强度
  - 优势: 非参数，对异常值稳健
  - 实现: `compute_correlation()` 函数 (scipy.stats.spearmanr)

#### 1.3 交互效应分析
- **OLS交互效应模型** (Ordinary Least Squares with Interaction Terms)
  - 模型公式: `price ~ accommodates * is_entire`
  - 用途: 检验房型与容量的交互效应
  - 实现: `fit_interaction_model()` 函数 (statsmodels.formula.api.ols)
  - 输出: 主效应系数 + 交互项系数

### 场景2: 黄金地段的绝对统治

#### 2.1 空间价格热力图
- **地理散点图** (Geographic Scatter Plot)
  - 用途: 展示价格的空间分布模式
- **六边形密度图** (Hexbin Density Plot)
  - 用途: 通过网格聚合展示价格密度，减少重叠
  - 聚合函数: 中位数 (median)

#### 2.2 区域分组对比
- **Kruskal-Wallis检验** (非参数多组比较)
  - 用途: 比较多个行政区（Manhattan, Brooklyn, Queens等）的价格分布
  - 优势: 不假设正态分布，适合多组比较
  - 实现: `test_group_differences()` 函数 (scipy.stats.kruskal)

### 场景3: 运营专业化带来的规模溢价

#### 3.1-3.4 规模效应分析
- **Kruskal-Wallis检验**
  - 用途: 比较不同房东规模组（1套、2-3套、4-5套、>5套）的价格和入住率差异
  - 分组变量: `host_listings_count_binned` (分箱后的房东房源数)
  - 实现: `test_group_differences()` 函数

### 场景4: 信任的货币化

#### 4.1 评分分布分析
- **核密度估计** (Kernel Density Estimation, KDE)
  - 用途: 估计评分分布的连续概率密度函数
  - 实现: `fit_kde()` 函数 (scipy.stats.gaussian_kde)
  - 优势: 平滑的密度曲线，比直方图更连续

#### 4.2 评分 vs 入住率
- **LOWESS平滑**
  - 参数: `frac=0.3`
  - 用途: 可视化评分与空置天数的非线性关系
- **线性回归**
  - 模型: `availability ~ review_rating`
  - 用途: 量化评分对入住率的影响
- **Spearman相关系数**
  - 用途: 测量评分与入住率的单调关系

#### 4.3 超赞房东对比
- **Mann-Whitney U检验**
  - 用途: 比较超赞房东与普通房东的空置天数分布
  - 实现: `scipy.stats.mannwhitneyu()`

### 场景5: 活跃度即需求的实时信号

#### 5.1-5.4 活跃度分析
- **Spearman秩相关系数**
  - 用途: 测量历史评论 vs LTM评论、LTM评论 vs 价格、LTM评论 vs 入住率的关系
  - 优势: 对异常值稳健，适合评论数这种计数数据
- **LOWESS平滑**
  - 参数: `frac=0.3`
  - 用途: 可视化评论数与价格/入住率的非线性趋势
- **线性回归** (Linear Regression)
  - 用途: 量化LTM评论数对价格和入住率的影响
  - 实现: `sklearn.linear_model.LinearRegression`

### 综合模型: 价格预测

#### 对数线性回归模型 (Log-Linear Regression)
- **模型类型**: OLS回归，因变量为对数变换后的价格
- **模型公式**: `log(price) ~ is_entire + accommodates + is_manhattan + is_superhost + host_listings_count + review_rating + reviews_ltm + latitude + longitude`
- **对数变换原因**: 价格数据右偏，对数变换使其更接近正态分布，满足线性回归假设
- **实现**: `fit_log_linear_model()` 函数 (statsmodels.api.OLS)
- **特征工程**:
  - 分类变量编码: `is_entire`, `is_manhattan`, `is_superhost` (0/1)
  - 连续变量: `accommodates`, `host_listings_count`, `review_rating`, `reviews_ltm`, `latitude`, `longitude`
- **模型输出**: 
  - 系数表 (coefficients)
  - 标准误 (standard errors)
  - t统计量 (t-statistics)
  - p值 (p-values)
  - 置信区间 (confidence intervals)

## 📈 主要模型结果

### 1. 隐私溢价模型
```
价格 = 29.63 + 37.33×容量 + 90.78×整租 - 10.75×容量×整租
```
- **模型类型**: OLS交互效应模型
- **整租溢价**: $90.78（独立于容量）
- **容量效应**: 每增加1人 +$37.33
- **交互效应**: 整租场景下容量效应减弱（交互项系数 = -10.75）

### 2. 位置溢价
- **检验方法**: Kruskal-Wallis检验（多组非参数比较）
- **结果**: Manhattan 整体溢价: 中位数比 Queens/Bronx 高 **100%**
- **子区域分析**: 黄金地段（Tribeca）溢价: 比普通区域高 **135%**
- **控制分析**: 即使控制物理条件（房型+容量），位置溢价依然显著

### 3. 规模溢价
- **检验方法**: Kruskal-Wallis检验（按房东规模分组）
- **价格结果**: 多房源房东（>5套）价格比单一房东高 **18%**
- **入住率结果**: 但空置率也更高，说明是"专业化库存管理"而非"需求不足"

### 4. 信任货币化
- **分析方法**: LOWESS平滑 + 线性回归 + Spearman相关
- **评分效应**: 评分每提升 0.1，空置天数减少约 **10-15天**
- **超赞房东**: Mann-Whitney U检验显示超赞房东标签带来显著的入住率优势

### 5. 活跃度信号
- **分析方法**: Spearman相关系数 + LOWESS平滑 + 线性回归
- **关键发现**: **LTM 评论数**对价格的解释力 > **历史评论数**
- **结论**: 证明市场为"实时需求"而非"历史声誉"定价

## 🎯 核心结论

1. **物理空间被系统性定价**: 隐私溢价 2.33倍，容量线性定价
2. **位置是定价的第一性因素**: 超越物理设施，核心区溢价显著
3. **规模带来专业化溢价**: 多房源房东具备准酒店化运营能力
4. **信任可被货币化**: 评分和超赞标签直接转化为入住率和现金流
5. **活跃度 = 实时需求信号**: 市场只对"正在发生的选择"敏感

## 📝 使用说明

所有图表已保存为 PNG 格式，可直接用于：
- PPT 演示
- 报告插入
- 论文配图

图表采用高分辨率（300 DPI），适合打印和展示。

## 📚 模型选择理由

### 为什么使用非参数检验？
1. **价格数据右偏**: 价格分布不满足正态分布假设，因此选择Mann-Whitney U和Kruskal-Wallis等非参数检验
2. **稳健性**: 非参数方法对异常值更稳健，适合真实世界数据

### 为什么使用LOWESS而非简单线性回归？
1. **非线性关系**: 许多变量间存在非线性关系（如评分与入住率），LOWESS能捕捉局部趋势
2. **非参数**: 不假设函数形式，让数据"自己说话"

### 为什么使用对数线性模型？
1. **价格右偏**: 对数变换使价格分布更接近正态，满足线性回归假设
2. **系数解释**: 对数线性模型的系数可以解释为百分比变化（近似）

### 为什么使用Spearman而非Pearson相关？
1. **单调关系**: Spearman测量单调关系，不要求线性
2. **稳健性**: 对异常值更稳健，适合评论数等计数数据

## 🔧 运行脚本

如需重新生成图表，运行：
```bash
python main.py
```

脚本会自动安装缺失的包并生成所有可视化图表。
